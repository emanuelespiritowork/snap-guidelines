# SNAP guidelines
This repository contains a list of guidelines to use Sentinel-1 SLC assets inside SNAP to create different products:
1) interferograms;
2) Digital Elevation Models (DEMs).
# Interferograms
Based on the tutorials:
- on creating the interferogram of [NASA](https://www.earthdata.nasa.gov/learn/data-recipes/create-interferogram-using-esas-sentinel-1-toolbox), [Skywatch](https://step.esa.int/docs/tutorials/S1TBX%20TOPSAR%20Interferometry%20with%20Sentinel-1%20Tutorial_v2.pdf), [ESA](https://esamultimedia.esa.int/multimedia/publications/TM-19/TM-19_InSAR_web.pdf);
- on phase-unwrapping of [NASA](https://www.earthdata.nasa.gov/learn/data-recipes/phase-unwrap-interferogram)

Follow this steps:
1) download two Sentinel-1 SLC images as *zip* files, one before and one after the date of earthquake or landslide. There are many sources for Sentinel-1 data. I suggest you to try with [Earthdata NASA](https://search.earthdata.nasa.gov) and [Copernicus Dataspace](https://browser.dataspace.copernicus.eu/). Both websites require free registration;
![image](https://github.com/user-attachments/assets/65aa0fc5-589d-4cfe-ab39-4e87621e400d) ![image](https://github.com/user-attachments/assets/f6631028-e2ef-4c11-891c-cfdfddd34dd5)
2) SAR instruments have different configurations and expert can give you advice on which data is better to choose to create proper interferograms. I am here to suggest to choose that images before and after should be from the same configuration (IW,SM,EW,WV,ascending,descending) but can be from different instrument (S1A and S1B);
3) open the SLC layers on SNAP. As a check, try to double click on an amplitude image and look at the result on the right panel;
![image](https://github.com/user-attachments/assets/802808a7-10c4-4b5c-9494-2017860739ad) ![image](https://github.com/user-attachments/assets/22c84d90-70f8-4455-89a6-d44743b1ef28)
4) *_Orb_Stack* coregistration of images. The tools is called *S-1 TOPS coregistration* and can be done with or without ESD (bursts-splitted images). Select in the *TOPSAR-Split* tab a sub-swath of the full image to coregister the images. If your S1 images have more than one polarization here you can choose which band to use for coregistration. In the Apply-Orbit-File tab you can choose orbital corrections: the default *Sentinel Precise* will choose the effemerides. Co-registration can also be assisted by DEM in *Back-Geocoding* tab. You can choose the default SRTM 3Sec or SRTM 1sec HGT (the one I choose for this tutorial). The *Output Deramp and Demod Phase* flag will try to improve the coregistration. After co-registration you will obtain a new object called *(name_of_your_first_image)_Orb_Stack*;
![image](https://github.com/user-attachments/assets/b5213dcd-c8d9-4bc4-9eb1-91be41a43249) ![OrbStack](https://github.com/user-attachments/assets/a395d143-8f46-4d94-b12f-9f4680785b71)
After the coregistration has ended, we can check the result using the _Open RGB Image Window_ tool. We can set the master (mst) image to be in the R and G channels while slave (slv) to be in the B channel. The coregistration has been corrected if the blue color does not emerge over yellow colours and if the borders are sharp. ![OpenRGBwindow](https://github.com/user-attachments/assets/b843f1c6-92d2-4df9-a6c8-3f2346c03835) ![OpenRGBwindowConf](https://github.com/user-attachments/assets/991ef2c8-ef64-40f0-bf1a-c6f9d4eaf928) ![OpenRGBresult](https://github.com/user-attachments/assets/34918088-1999-4408-b119-869825bf1fa5)
5) *_Orb_Stack_ifg* creation of the interferogram. The idea is to multiply the coregistered master image to the complex conjugate of the coregistered slave image. Use the tool _interferogram formation_. We are interested in looking only at the phase difference due to the landslide or earthquake so we want to get rid of other contributions to that phase difference. First, we will subtract the flat-earth phase that is the Earth's curvature contribution to the phase that can be removed using orbital data and ellipsoid parameters. During this steps we also create a coherence layer that is used to determine the quality of the final interferogram using the fact that neighbour terrain pixels should have similar values of phase value. Low coherence (< 0.3) will be found in forests where trees will mask the terrain, while high coherence (> 0.6) will be found in cities where flat surfaces quite parallel to the terrain will be stable between images. The coherence layer will be used in the unwrapping step to create a significative displacement map. Run the _interferogram formation_ tool with default parameters. The topographic contribution to the phase can be removed here but we prefer to remove in a different step. THe result of the interferogram formation has a Phase band that is the interferogram; ![Interferogram_formation](https://github.com/user-attachments/assets/dad4ad59-f998-47a8-a041-dd797363de39) ![Coherence](https://github.com/user-attachments/assets/955c6dee-5499-4d65-ad25-3f8b80cddd5b) ![Ifg](https://github.com/user-attachments/assets/547998ac-30aa-4561-81a8-bd385da035f6)
6) *_Orb_Stack_ifg_deb* eliminate the grid between bursts. Sentinel-1 images are taken into a bursts mode so they are a collage of spot. In between, there are blind spots that can be filled using the _TOPS deburst_ tool ![Deburst](https://github.com/user-attachments/assets/517d3032-1cf2-4f22-bfa5-ef80c1240036)
 ![PhaseDeburst](https://github.com/user-attachments/assets/d5988bbf-2077-4d45-b8b0-cab7d7c5b353)
7) *_Orb_Stack_ifg_deb_dinsar* remove the topographic contribution to the phase. The _Topographic phase removal_ tool will delete topographic contribution to the phase which comes from a topographic respect to the flat terrain (relative to the ellipsoid surface). A DEM formation wants to preserve and use this phase change but here we want to see terrain changes in time. We then use a DTM to eliminate this topographic contribution. The DEM of this tutorial is SRTM 1sec HGT ![TopographicPhaseRemoval](https://github.com/user-attachments/assets/dd609f89-9e8b-443c-bbd6-7f88620ff76a) ![TopographicPhaseRemoval_result](https://github.com/user-attachments/assets/a772eaf2-f1c4-4a05-bcf7-ba35c4ea22fd)
8) *_Orb_Stack_ifg_deb_ML_flt* other phase contribution removal. Atmospheric noise, volume scattering, time variation of scatterers and different view angles or orbit configuration (ascending or descending) give other contribution to the phase change between images. Removing these will first require multi-looking tool that is a bidimensional spatial filter, acting as a convolutional kernel. Choose the bands i (real), q (imaginary), coh (coherence). The phase band (which is a derived band respect to i and q) will disapper and come back later. Use look number as 6 ![Multilooking](https://github.com/user-attachments/assets/e99ae22d-0ca6-4d93-b6d5-88fa4f24f74b) ![Multilooking_conf](https://github.com/user-attachments/assets/6c06452d-bb52-4704-aece-b7adb34ac306)
9) *_Orb_Stack_ifg_deb_ML_flt* Goldstein phase filtering. We use a Fast Fourier Transform (FFT) to improve SNR (signal to noise ratio) ![Goldstein](https://github.com/user-attachments/assets/ad10373c-5b6e-4ea3-9d4f-359407532098) ![Goldstein_result](https://github.com/user-attachments/assets/54bd5eab-d331-401a-961f-5161b1b20bae)
10)  (_Orb_Stack_ifg_deb_ML_flt_subset) selezioniamo un subset dopo aver cliccato con il tasto destro sulla zona interessata e usato la funzione “Spatial subset from View”;
(_Orb_Stack_ifg_deb_ML_flt_subset_unw) ora eseguiamo l’unwrapping ovvero vogliamo avere una variazione continua della fase che non ricominci ogni 2π: si divide in tre fasi: esportiamo la wrapped phase con “Snaphu export”: selezionare 200 per row overlap e per column overlap. Qui si possono selezionare i parametri per l’unwrapping; usiamo “Snaphu unwrapping”: seleziono il prodotto che è stato scelto da esportare e come cartella seleziono la cartella del prodotto esportato. Uso il Display execution output per vedere se la procedura funziona. Se non funziona, bisogna andare nelle impostazioni “Manage External Tools”, selezionare Snaphu unwrapping e modificare in “Edit the selected operator”. Nella variabile USERPROFILE che si trova in System variables inserire la cartella del prodotto esportato. Far partire nuovamente lo strumento. Se non dovesse funzionare controllare di avere abbastanza spazio su disco; usiamo “Snaphu Import”: in ReadPhase seleziono il prodotto che è stato scelto da esportare. In Read-Unwrapped-Phase seleziono il file .hdr della unwrapped phase. In Snaphu-Import lascio non selezionato il non-salvataggio. In Write aggiungo _unw al nome. (_Orb_Stack_ifg_deb_ML_flt_subset_unw_dsp) vogliamo ora passare dalla fase unwrapped allo spostamento. Per questo usiamo “Phase to Displacement”. Quando si effettua questo passaggio viene lasciato indietro il layer di coherence. Se si vuole riportarlo si può usare Band Maths sul layer di displacement, tolgo la selezione Virtuale e come espressione preso il file _unw e seleziono la banda coherence; (_Orb_Stack_ifg_deb_ML_flt_subset_unw_dsp_TC) applico la funzione “Range Doppler Terrain correction” per riportare dalle slant range coordinates (che sono le coordinate radar) alle ground range coordinates (che sono le coordinate sul terreno). Per far questo si usa un DEM di riferimento. Se si vuole esportare su Google Earth conviene usare WGS84; esportare con “View as Google Earth KMZ” come file KMZ in modo da poterlo caricare su Google Earth.
# DEM generation
Based on the tutorials:
- [ESA](https://step.esa.int/docs/tutorials/S1TBX%20DEM%20generation%20with%20Sentinel-1%20IW%20Tutorial.pdf)
